<!DOCTYPE html>
<html lang="{{ page.lang | default: 'it' }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ page.title | default: site.title }}</title>

  {{ 
  https://cdn.jsdelivr.net/npm/@fluentui/svg-icons/fonts/fluent-icons.css
  <meta name="color-scheme" content="light dark" />
</head>

<body class="wt-body">

  {%- comment -%}
    LANGUAGE DETECTION (robusta):
    - Usa page.lang se presente
    - Altrimenti controlla il path SENZA baseurl per '/en/'
    - Calcola gli URL IT/EN in base al path neutro
  {%- endcomment -%}

  {%- assign is_en = false -%}

  {%- if page.lang == 'en' -%}
    {%- assign is_en = true -%}
  {%- else -%}
    {%- assign base = site.baseurl | default: '' -%}
    {%- assign path = page.url | default: '/' -%}
    {%- assign path_no_base = path | remove_first: base -%}
    {%- if path_no_base contains '/en/' or path_no_base == '/en' or path_no_base == '/en/' -%}
      {%- assign is_en = true -%}
    {%- endif -%}
  {%- endif -%}

  {%- assign base = site.baseurl | default: '' -%}
  {%- assign current_path = page.url | default: '/' | remove_first: base -%}

  {%- if is_en -%}
    {%- assign url_it = current_path | remove_first: '/en' -%}
    {%- assign url_en = current_path -%}
  {%- else -%}
    {%- assign url_it = current_path -%}
    {%- assign url_en = '/en' | append: current_path -%}
  {%- endif -%}

  {%- assign en_enabled = site.data.i18n.en_enabled | default: false -%}

  <!-- HEADER -->
  <header class="wt-header">
    <div class="wt-container wt-nav">

      <!-- BRAND -->
      <div class="wt-brand">
        {{ 
          {% if site.brand.logo %}
            {{ site.brand.logo | relative_url }}
          {% endif %}
          <span class="wt-brand-text">{{ site.brand.name }}</span>
        </a>
      </div>

      <!-- LANGUAGE SWITCHER -->
      <div class="wt-lang">
        {{ url_it | relative_url }}IT</a>
        <span class="wt-lang-sep">|</span>
        {% if en_enabled %}
          <a class="wt-lang-item {% if is_en %}active{% endif %}" href="{{ url_en | relative_url }}">EN</a>
        {% else %}
          <span class="wt-lang-item wt-disabled">EN</span>
        {% endif %}
      </div>

      <!-- BURGER -->
      <button class="wt-burger" onclick="WT.toggleSidebar()">☰</button>

      <!-- NAV DESKTOP -->
      {% if is_en and site.nav_en %}
        {% assign nav_items = site.nav_en %}
      {% else %}
        {% assign nav_items = site.nav %}
      {% endif %}

      <nav class="wt-menu">
        {% for item in nav_items %}
          <a href="{{ item.url | relative_url }}">{{ item.name }}</a>
        {% endfor %}
      </nav>

    </div>
  </header>

  <!-- SIDEBAR MOBILE -->
  <aside id="wt-sidebar" class="wt-sidebar" aria-hidden="true">

    <div class="wt-sidebar-head">
      <strong>Menu</strong>
      <button onclick="WT.toggleSidebar()">×</button>
    </div>

    <!-- NAV MOBILE -->
    {% if is_en and site.nav_en %}
      {% assign nav_items_sidebar = site.nav_en %}
    {% else %}
      {% assign nav_items_sidebar = site.nav %}
    {% endif %}

    <nav class="wt-sidebar-links">
      {% for item in nav_items_sidebar %}
        <a href="{{ item.url | relative_url }}">{{ item.name }}</a>
     heme">
      <div class="wt-lang wt-lang-mobile">
        {{ url_it | relative_url }}IT</a>
        <span class="wt-lang-sep">|</span>
        {% if en_enabled %}
          {{ url_en | relative_url }}EN</a>
        {% else %}
          <span class="wt-lang-item wt-disabled">EN</span>
        {% endif %}
      </div>
    </div>

  </aside>

  <!-- MAIN -->
  <main class="wt-main wt-container">
    {{ content }}
  </main>

  <!-- FOOTER -->
  <footer class="wt-footer">
    <div class="wt-container">
      © {{ site.time | date: "%Y" }} {{ site.brand.name }} — Tutti i diritti riservati
    </div>
  </footer>

  <script src="{{ '/assets/js/site.js' | relative_url }}"></script>
  <script>
    if (window.WT && WT.applyStoredTheme) WT.applyStoredTheme();
  </script>

</body>
</html>
